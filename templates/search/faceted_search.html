{% extends 'base.html' %}
{% load highlight %}

{% block title %} Search: {{ query }} {% endblock %}

{% block content %}
<form method="get" action=".">
    <table>
        <tbody>
            {{ form.as_table }}
            <tr>
                <td>&nbsp;</td>
                <td><input type="submit" value="Search"></td>
            </tr>
        </tbody>
    </table>
</form>

{% if query %}
    <!-- Begin faceting. -->
    <h2>By Author</h2>

    <div>
        <dl>
            {% if facets.fields.project %}
                <dt>Author</dt>
                {# Provide only the top 5 projects #}
                {% for project in facets.fields.project|slice:":10" %}
                    <dd><a href="{{ request.get_full_path }}&amp;selected_facets=project:{{ project.0|urlencode }}">{{ project.0 }}</a> ({{ project.1 }})</dd>
                {% endfor %}
            {% else %}
                <p>No project facets.</p>
            {% endif %}
        </dl>
    </div>
    <!-- End faceting -->
{% endif %}


{% if query %}
<!-- BEGIN search results -->
<div class="module">
  <div class="module-wrapper">

    <div class="module-header">
      <h3>Results for {{ query }}</h3>
    </div>

    <div class="module-list">
      <div class="module-list-wrapper">

        <ul>
          {% for result in page.object_list %}
            <li class="module-item">
            {% ifequal result.model_name 'project' %}
              <p class="module-item-title">
                Project:
                <a href="{{ result.object.get_absolute_url }}">{{ result.title }} - {{ result.author }}</a>
              </p>
              {% else %}
              <p class="module-item-title">
                File:
                <a href="{{ result.object.get_absolute_url }}?highlight={{ query }}">{{ result.project }} - {{ result.title }}</a>
              </p>
              <p>
                {% highlight result.text with query %}
              </p>
              {% endifequal %}
            </li>
          {% empty %}
            <li class="module-item"><span class="quiet">No results found. Bummer.</span></li>
          {% endfor %}
        </ul>

      </div>
    </div>

  </div>
</div>
<!-- END search results -->

  {% if page.has_previous or page.has_next %}
  <!-- BEGIN search pagination -->
  <div class="pagination">
    {% if page.has_previous %}
      <a href="?q={{ query }}&amp;page={{ page.previous_page_number }}">&laquo; Previous</a>
    {% else %}
      <span class="disabled">&laquo; Previous</span>
    {% endif %}

    {% if page.has_next %}
      <a class="next" href="?q={{ query }}&amp;page={{ page.next_page_number }}">Next &raquo;</a>
    {% else %}
      <span class="next disabled">Next &raquo;</span>
    {% endif %}
  </div>
  <!-- END search pagination -->
  {% endif %}

{% else %}
  {# Show some example queries to run, maybe query syntax, something else? #}
{% endif %}


{% endblock %}
