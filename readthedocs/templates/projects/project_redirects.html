{% extends "projects/project_edit_base.html" %}

{% load i18n %}

{% block title %}{% trans "Edit Redirects" %}{% endblock %}

{% block project-redirects-active %}active{% endblock %}
{% block project_edit_content_header %}{% trans "Redirects" %}{% endblock %}

{% block extra_scripts %}
  <script type="text/javascript">
    $(document).ready(function() {
      $('#id_from_url').parent().hide()
      $('#id_to_url').parent().hide()
    
      $('#id_redirect_type').on('change', function() {
        if (this.value == 'prefix') {
            $('#id_from_url').parent().show()
            $('#id_to_url').parent().hide()
        }
        if (this.value == 'page') {
            $('#id_from_url').parent().show()
            $('#id_to_url').parent().show()
        }
        if (this.value == 'sphinx_html' || this.value == 'sphinx_htmldir') {
            $('#id_from_url').parent().hide()
            $('#id_to_url').parent().hide()
        }
        if (this.value == 'advanced') {
            $('#id_from_url').parent().show()
            $('#id_to_url').parent().show()
        }
    }); 
    });

    $(document).ready(function() { 
      var msg_from = new Array();
      var index = -1; 
      $('#id_from_url').keydown(function(event) { 

        switch(event.keyCode) {
            case 8: //delete to the left or backspace 
                if (msg_from.length != 0 && index != -1 ) {
                    msg_from.splice(index, 1); 
                    index = index - 1; 
                }
                break; 
            case 46: //delete to the right or forward backspace 
                if (msg_from.length != 0 && index != msg_from.length - 1) { 
                  msg_from.splice(index+1, 1);
                }
                break; 
            case 37: //move one space to the left 
                if (index != -1 ) { index = index - 1; }
                break; 
            case 39: //move one space to the right 
                if (index != msg_from.length - 1 ) { index = index + 1; } 
                break; 
            case 190: 
                msg_from.push("."); 
                index = index + 1 
                break;
            case 191: 
                msg_from.push("/"); 
                index = index + 1 
                break;  
            default: 
                var letter = String.fromCharCode(event.which); 
                msg_from.push(letter.toLowerCase()); 
                index = index + 1;  
        }
        console.log("Outcome:" + msg_from.join("") + "faq.html -> /$lang/$version/faq.html"); 
      }); 

      // $('#id_to_url').keydown(function(event) { 
      //   var letter = String.fromCharCode(event.which); 
      //   msg_to = msg_to + letter; 
      //   word = msg_to.split("/")
      //   // console.log("Outcome: /$lang/$version/" + msg_from " --> /$lang/$version/" + word[0] + "/" + word[1] + ".html"); 
      // }); 
    }); 
  </script>
{% endblock %}

{% block project_edit_content %}
  <p class="help_text">
    {% trans "Add redirects for your project. This allows you to fix links to old pages that are 404ing." %}
  </p>

  {% if redirects|length >= 1 %}
  <h3>{% trans "Existing Redirects" %}</h3>
  <p>
    <ul>
    {% for redirect in redirects %}
        <li>
        {{ redirect }}
        </a>
        </li>
    {% endfor %}
    </ul>
  {% endif %}

  {% if redirects|length >= 1 %}
  <h3>{% trans "Remove Redirect" %}</h3>
    <p>
        <form method="post" action="{% url "projects_redirects_delete" project.slug %}">
            {% csrf_token %}
          <select id="id_pk" name="pk">
          {% for redirect in redirects %}
            <option value="{{ redirect.pk }}">{{ redirect }}</option>
          {% endfor %}
          </select>
          <input type="submit" value="Remove">
        </form>
    </p>
  {% endif %}

  <form method="post" action=".">{% csrf_token %}
    {{ form.as_p }}
    <p>
      <input style="display: inline;" type="submit" value="{% trans "Submit" %}">
    </p>
  </form>
{% endblock %}